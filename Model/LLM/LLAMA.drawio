<mxfile host="Electron" modified="2024-05-06T09:29:42.298Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/24.2.5 Chrome/120.0.6099.109 Electron/28.1.0 Safari/537.36" etag="tpBmuhQPEvtfQZ3iam_I" version="24.2.5" type="device">
  <diagram name="第 1 页" id="lJStV8RaI5A1z8thdrf8">
    <mxGraphModel dx="2832" dy="2044" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-1" target="XuyY1v07Ao4F7MrTUdh4-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-1" target="XuyY1v07Ao4F7MrTUdh4-7">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="498" y="140" />
              <mxPoint x="400" y="140" />
              <mxPoint x="400" y="320" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-1" target="XuyY1v07Ao4F7MrTUdh4-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-1" target="XuyY1v07Ao4F7MrTUdh4-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-1" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;__init__()&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="20" width="190" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-2" target="XuyY1v07Ao4F7MrTUdh4-37">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-2" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div style=&quot;line-height: 19px;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;self&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;model&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;BaichuanModel&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;config&lt;/span&gt;)&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="20" y="190" width="290" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-3" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;self&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;lm_head&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;NormHead&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;config&lt;/span&gt;.hidden_size, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;config&lt;/span&gt;.vocab_size, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;bias&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;False&lt;/span&gt;)&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="680" y="190" width="610" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-4" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;quantize_offline(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;self&lt;/span&gt;, &lt;span style=&quot;color: #b5cea8;&quot;&gt;4&lt;/span&gt;)&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="440" y="190" width="210" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-6" value="if quantize" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="480" y="140" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-7" target="XuyY1v07Ao4F7MrTUdh4-9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-7" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;self&lt;/span&gt;.post_init()&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="470" y="290" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-9" target="XuyY1v07Ao4F7MrTUdh4-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-9" target="XuyY1v07Ao4F7MrTUdh4-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-9" value="&lt;nav style=&quot;box-sizing: border-box; max-width: 100%; color: rgb(230, 237, 243); font-family: -apple-system, BlinkMacSystemFont, &amp;quot;Segoe UI&amp;quot;, &amp;quot;Noto Sans&amp;quot;, Helvetica, Arial, sans-serif, &amp;quot;Apple Color Emoji&amp;quot;, &amp;quot;Segoe UI Emoji&amp;quot;; font-size: 14px; text-align: start; background-color: rgb(22, 27, 34);&quot; class=&quot;Box-sc-g0xbh4-0 kzRgrI&quot; id=&quot;sticky-breadcrumb&quot; aria-labelledby=&quot;sticky-breadcrumb-heading&quot; data-testid=&quot;breadcrumbs&quot;&gt;&lt;ol style=&quot;box-sizing: border-box; padding-left: 0px; margin-top: 0px; margin-bottom: 0px; max-width: 100%; list-style: none; display: inline-block;&quot; class=&quot;Box-sc-g0xbh4-0 cmAPIB&quot;&gt;&lt;li style=&quot;box-sizing: border-box; display: inline-block; max-width: 100%;&quot; class=&quot;Box-sc-g0xbh4-0 jwXCBK&quot;&gt;&lt;a style=&quot;box-sizing: border-box; background-color: transparent; color: var(--fgColor-accent,var(--color-accent-fg,#2f81f7)); text-decoration-line: none; font-weight: 600;&quot; href=&quot;https://github.com/huggingface/transformers/tree/main&quot; class=&quot;Link__StyledLink-sc-14289xe-0 dpowyu&quot; data-testid=&quot;breadcrumbs-repo-link&quot;&gt;transformers&lt;/a&gt;&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; display: inline-block; max-width: 100%;&quot; class=&quot;Box-sc-g0xbh4-0 jwXCBK&quot;&gt;&lt;span style=&quot;box-sizing: border-box; padding-left: 4px; padding-right: 4px; color: var(--fgColor-muted,var(--color-fg-muted,#848d97));&quot; class=&quot;Text-sc-17v1xeu-0 fQxKLn&quot; aria-hidden=&quot;true&quot;&gt;/&lt;/span&gt;&lt;a style=&quot;box-sizing: border-box; background-color: transparent; color: var(--fgColor-accent,var(--color-accent-fg,#2f81f7)); text-decoration-line: none;&quot; href=&quot;https://github.com/huggingface/transformers/tree/main/src&quot; class=&quot;Link__StyledLink-sc-14289xe-0 csCkZA&quot;&gt;src&lt;/a&gt;&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; display: inline-block; max-width: 100%;&quot; class=&quot;Box-sc-g0xbh4-0 jwXCBK&quot;&gt;&lt;span style=&quot;box-sizing: border-box; padding-left: 4px; padding-right: 4px; color: var(--fgColor-muted,var(--color-fg-muted,#848d97));&quot; class=&quot;Text-sc-17v1xeu-0 fQxKLn&quot; aria-hidden=&quot;true&quot;&gt;/&lt;/span&gt;&lt;a style=&quot;box-sizing: border-box; background-color: transparent; color: var(--fgColor-accent,var(--color-accent-fg,#2f81f7)); text-decoration-line: none;&quot; href=&quot;https://github.com/huggingface/transformers/tree/main/src/transformers&quot; class=&quot;Link__StyledLink-sc-14289xe-0 csCkZA&quot;&gt;transformers&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/nav&gt;&lt;div style=&quot;box-sizing: border-box; display: inline-block; max-width: 100%; color: rgb(230, 237, 243); font-family: -apple-system, BlinkMacSystemFont, &amp;quot;Segoe UI&amp;quot;, &amp;quot;Noto Sans&amp;quot;, Helvetica, Arial, sans-serif, &amp;quot;Apple Color Emoji&amp;quot;, &amp;quot;Segoe UI Emoji&amp;quot;; font-size: 14px; text-align: start; background-color: rgb(22, 27, 34);&quot; class=&quot;Box-sc-g0xbh4-0 jwXCBK&quot; data-testid=&quot;breadcrumbs-filename&quot;&gt;&lt;span style=&quot;box-sizing: border-box; padding-left: 4px; padding-right: 4px; color: var(--fgColor-muted,var(--color-fg-muted,#848d97));&quot; class=&quot;Text-sc-17v1xeu-0 fQxKLn&quot; aria-hidden=&quot;true&quot;&gt;/&lt;/span&gt;&lt;h1 style=&quot;box-sizing: border-box; font-size: 14px; margin: 0px; display: inline-block; max-width: 100%;&quot; class=&quot;Heading__StyledHeading-sc-1c1dgg0-0 jAEDJk&quot; id=&quot;sticky-file-name-id&quot; tabindex=&quot;-1&quot;&gt;modeling_utils.py&lt;/h1&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="426.25" y="390" width="237.5" height="40" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-11" target="XuyY1v07Ao4F7MrTUdh4-15">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="420" y="570" />
              <mxPoint x="235" y="570" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-11" target="XuyY1v07Ao4F7MrTUdh4-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-11" target="XuyY1v07Ao4F7MrTUdh4-22">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="580" y="630" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-11" value="self.init_weights()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="390" y="490" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-13" value="self._backward_compatibility_gradient_checkpointing()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="560" y="490" width="320" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-15" value="self.prune_heads(self.config.pruned_heads)" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="110" y="630" width="250" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-17" value="if prune_head" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="160" y="570" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-25" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-19" target="XuyY1v07Ao4F7MrTUdh4-24">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-19" value="self._initialize_weights" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="390" y="630" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-22" value="self.tie_weights&lt;div&gt;q/k/v复用同一权重&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="590" y="630" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-23" value="if _init_weights" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="470" y="555" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-27" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-24" target="XuyY1v07Ao4F7MrTUdh4-26">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-24" value="self._init_weights(module)" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="382.5" y="740" width="175" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-26" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;_init_weights()&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div style=&quot;line-height: 19px;&quot;&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;BaichuanPreTrainedModel&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="360" y="850" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-31" target="XuyY1v07Ao4F7MrTUdh4-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-31" target="XuyY1v07Ao4F7MrTUdh4-34">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-31" target="XuyY1v07Ao4F7MrTUdh4-37">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="503" />
              <mxPoint x="-30" />
              <mxPoint x="-30" y="280" />
              <mxPoint x="-175" y="280" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-31" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;BaichuanForCausalLM&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="460" y="-90" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-34" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #dcdcaa;&quot;&gt;from_pretrained&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;font color=&quot;#dcdcaa&quot;&gt;路径、下载、加载权重（&lt;/font&gt;&lt;span style=&quot;color: rgb(220, 220, 170);&quot;&gt;量化）&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-280" y="190" width="210" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-37" target="XuyY1v07Ao4F7MrTUdh4-41">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-50" y="430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-37" target="XuyY1v07Ao4F7MrTUdh4-43">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-280" y="420" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-37" value="forward()" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-235" y="320" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-47" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-41" target="XuyY1v07Ao4F7MrTUdh4-46">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-41" value="如果有，算loss" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-50" y="420" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-45" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-43" target="XuyY1v07Ao4F7MrTUdh4-44">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-49" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-43" target="XuyY1v07Ao4F7MrTUdh4-48">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-43" value="self.model()" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-320" y="420" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-44" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;self&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;lm_head&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;hidden_states&lt;/span&gt;)&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-375" y="525" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-46" value="&lt;div style=&quot;color: #cccccc;background-color: #1f1f1f;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;CrossEntropyLoss()+&lt;/span&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;z_loss&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-95" y="525" width="210" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-53" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-48" target="XuyY1v07Ao4F7MrTUdh4-52">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-48" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;use_cache&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;past_key_value: &lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: rgb(31, 41, 55); font-family: &amp;quot;IBM Plex Mono&amp;quot;, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, &amp;quot;Liberation Mono&amp;quot;, &amp;quot;Courier New&amp;quot;, monospace; text-align: left; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;tuple(tuple(torch.FloatTensor)&lt;/span&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: rgb(75, 85, 99); font-family: &amp;quot;Source Sans Pro&amp;quot;, ui-sans-serif, system-ui, sans-serif, &amp;quot;Apple Color Emoji&amp;quot;, &amp;quot;Segoe UI Emoji&amp;quot;, &amp;quot;Segoe UI Symbol&amp;quot;, &amp;quot;Noto Color Emoji&amp;quot;; font-size: 16px; text-align: left; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;code style=&quot;box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgb(229, 231, 235); --tw-border-spacing-x: 0; --tw-border-spacing-y: 0; --tw-translate-x: 0; --tw-translate-y: 0; --tw-rotate: 0; --tw-skew-x: 0; --tw-skew-y: 0; --tw-scale-x: 1; --tw-scale-y: 1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness: proximity; --tw-gradient-from-position: ; --tw-gradient-via-position: ; --tw-gradient-to-position: ; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgb(59 130 246 / .5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; --tw-shadow: 0 0 #0000; --tw-shadow-colored: 0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; font-family: &amp;quot;IBM Plex Mono&amp;quot;, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, &amp;quot;Liberation Mono&amp;quot;, &amp;quot;Courier New&amp;quot;, monospace; font-feature-settings: normal; font-variation-settings: normal; font-size: 0.875rem; color: rgb(31 41 55 / var(--tw-text-opacity)); line-height: 1.25rem; --tw-text-opacity: 1; text-align: left; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;(batch_size, num_heads, sequence_length, embed_size_per_head)&lt;/code&gt;&lt;span style=&quot;color: rgb(31, 41, 55); font-family: &amp;quot;IBM Plex Mono&amp;quot;, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, &amp;quot;Liberation Mono&amp;quot;, &amp;quot;Courier New&amp;quot;, monospace; text-align: left; white-space: normal; background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-790" y="370" width="250" height="160" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-56" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-50" target="XuyY1v07Ao4F7MrTUdh4-55">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-50" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;self&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;embed_tokens&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-747.5" y="700" width="165" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-54" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-52" target="XuyY1v07Ao4F7MrTUdh4-50">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-52" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;seq_length_with_past&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;seq_length_with_past&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;+&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;past_key_values_length&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-950" y="590" width="570" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-58" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-55" target="XuyY1v07Ao4F7MrTUdh4-57">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-55" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;self&lt;/span&gt;.&lt;span style=&quot;color: #dcdcaa;&quot;&gt;get_alibi_mask&lt;/span&gt;()&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-758.75" y="810" width="187.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-63" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-57" target="XuyY1v07Ao4F7MrTUdh4-59">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-57" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;attention_mask&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-725" y="920" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-65" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-59" target="XuyY1v07Ao4F7MrTUdh4-64">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-68" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-59" target="XuyY1v07Ao4F7MrTUdh4-67">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-72" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-59" target="XuyY1v07Ao4F7MrTUdh4-71">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-59" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;decoder_layer&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-825" y="1055" width="320" height="160" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-60" value="&lt;div style=&quot;color: rgb(204, 204, 204); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; text-align: center; white-space: pre;&quot;&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;hidden_states&lt;/span&gt;,&lt;/div&gt;&lt;div style=&quot;color: rgb(204, 204, 204); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; text-align: center; white-space: pre;&quot;&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;attention_mask&lt;/span&gt;&lt;span style=&quot;color: rgb(212, 212, 212);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;attention_mask&lt;/span&gt;,&lt;/div&gt;&lt;div style=&quot;color: rgb(204, 204, 204); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; text-align: center; white-space: pre;&quot;&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;past_key_value&lt;/span&gt;&lt;span style=&quot;color: rgb(212, 212, 212);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;past_key_value&lt;/span&gt;,&lt;/div&gt;&lt;div style=&quot;color: rgb(204, 204, 204); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; text-align: center; white-space: pre;&quot;&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;output_attentions&lt;/span&gt;&lt;span style=&quot;color: rgb(212, 212, 212);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;output_attentions&lt;/span&gt;,&lt;/div&gt;&lt;div style=&quot;color: rgb(204, 204, 204); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; text-align: center; white-space: pre;&quot;&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;use_cache&lt;/span&gt;&lt;span style=&quot;color: rgb(212, 212, 212);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(156, 220, 254);&quot;&gt;use_cache&lt;/span&gt;,&lt;/div&gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" vertex="1" parent="XuyY1v07Ao4F7MrTUdh4-59">
          <mxGeometry y="30" width="320" height="130" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-64" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;self&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;norm&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;hidden_states&lt;/span&gt;)&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontStyle=0;startSize=30;" vertex="1" parent="1">
          <mxGeometry x="-767.5" y="1290" width="205" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-67" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;next_decoder_cache&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;+=&lt;/span&gt; (&lt;span style=&quot;color: #9cdcfe;&quot;&gt;layer_outputs&lt;/span&gt;[&lt;span style=&quot;color: #b5cea8;&quot;&gt;2&lt;/span&gt; &lt;span style=&quot;color: #c586c0;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;output_attentions&lt;/span&gt; &lt;span style=&quot;color: #c586c0;&quot;&gt;else&lt;/span&gt; &lt;span style=&quot;color: #b5cea8;&quot;&gt;1&lt;/span&gt;],)&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontStyle=0;startSize=30;" vertex="1" parent="1">
          <mxGeometry x="-1580" y="1105" width="575" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-69" value="if use_cache" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-950" y="1090" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-71" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;BaichuanLayer&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;config&lt;/span&gt;)&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontStyle=0;startSize=30;" vertex="1" parent="1">
          <mxGeometry x="-420" y="1105" width="185" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-73" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;size=0.5;" vertex="1" parent="1">
          <mxGeometry x="-235" y="870" width="20" height="690" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-77" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-74" target="XuyY1v07Ao4F7MrTUdh4-76">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-79" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-74" target="XuyY1v07Ao4F7MrTUdh4-78">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-84" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-74" target="XuyY1v07Ao4F7MrTUdh4-82">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-74" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;input_layernorm&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-180" y="830" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-76" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;RMSNorm&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="20" y="830" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-81" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-78" target="XuyY1v07Ao4F7MrTUdh4-80">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-83" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-78" target="XuyY1v07Ao4F7MrTUdh4-82">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-78" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;self_attn&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-180" y="970" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-80" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;BaichuanAttention&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="20" y="970" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-86" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-82" target="XuyY1v07Ao4F7MrTUdh4-85">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-82" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;hidden_states&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;residual&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;+&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;hidden_states&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-180" y="1110" width="440" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-88" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-85" target="XuyY1v07Ao4F7MrTUdh4-87">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-91" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-85" target="XuyY1v07Ao4F7MrTUdh4-90">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-96" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-85" target="XuyY1v07Ao4F7MrTUdh4-94">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-160" y="1270" />
              <mxPoint x="-160" y="1550" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-85" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;post_attention_layernorm&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-75" y="1240" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-87" value="&lt;span style=&quot;color: rgb(78, 201, 176); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; white-space: pre; background-color: rgb(31, 31, 31);&quot;&gt;RMSNorm&lt;/span&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="210" y="1240" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-93" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-90" target="XuyY1v07Ao4F7MrTUdh4-92">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-95" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-90" target="XuyY1v07Ao4F7MrTUdh4-94">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-90" value="&lt;div style=&quot;color: #cccccc;background-color: #1f1f1f;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;mlp&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-20" y="1380" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-98" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-92" target="XuyY1v07Ao4F7MrTUdh4-97">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-92" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #4ec9b0;&quot;&gt;MLP&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="180" y="1380" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-94" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;hidden_states&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;residual&lt;/span&gt; &lt;span style=&quot;color: #d4d4d4;&quot;&gt;+&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;hidden_states&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-135" y="1520" width="350" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-97" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;self&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;down_proj&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;self&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;act_fn&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;self&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;gate_proj&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;x&lt;/span&gt;)) &lt;span style=&quot;color: #d4d4d4;&quot;&gt;*&lt;/span&gt; &lt;span style=&quot;color: #9cdcfe;&quot;&gt;self&lt;/span&gt;.&lt;span style=&quot;color: #9cdcfe;&quot;&gt;up_proj&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;x&lt;/span&gt;))&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="380" y="1380" width="520" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-99" value="" style="shape=flexArrow;endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="190" y="1000" as="sourcePoint" />
            <mxPoint x="770" y="1000" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-100" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="780" y="940" width="20" height="120" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-104" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-102" target="XuyY1v07Ao4F7MrTUdh4-103">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-109" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-102" target="XuyY1v07Ao4F7MrTUdh4-110">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1040" y="900" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-102" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: #9cdcfe;&quot;&gt;W_pack&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;font color=&quot;#9cdcfe&quot;&gt;映射3倍hidden，&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;font color=&quot;#9cdcfe&quot;&gt;拆成q/k/v&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="790" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-106" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-103" target="XuyY1v07Ao4F7MrTUdh4-105">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-103" value="传统去q/kmatmul&lt;div&gt;加attention_mask&lt;/div&gt;&lt;div&gt;softmax&lt;/div&gt;&lt;div&gt;softmax后乘以value_state&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="890" width="120" height="90" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-108" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XuyY1v07Ao4F7MrTUdh4-105" target="XuyY1v07Ao4F7MrTUdh4-107">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-105" value="reshape" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="1020" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-107" value="o_proj" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="1130" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XuyY1v07Ao4F7MrTUdh4-110" value="sdpa" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="990" y="900" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
