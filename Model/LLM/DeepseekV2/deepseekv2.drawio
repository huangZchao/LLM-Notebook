<mxfile host="Electron" modified="2024-07-22T15:32:01.437Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/24.4.0 Chrome/120.0.6099.109 Electron/28.1.0 Safari/537.36" etag="NN0tG83DXDEPuG6GWdFW" version="24.4.0" type="device" pages="4">
  <diagram name="DeepseekV2ForCausalLM" id="sjKBI5eqnztE4ck6Wnw2">
    <mxGraphModel dx="1429" dy="847" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="F_c80MLcyVx9tp0hUTVe-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="F_c80MLcyVx9tp0hUTVe-1" target="F_c80MLcyVx9tp0hUTVe-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F_c80MLcyVx9tp0hUTVe-1" value="DeepseekV2ForCausalLM" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="334" y="350" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F_c80MLcyVx9tp0hUTVe-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="F_c80MLcyVx9tp0hUTVe-2" target="F_c80MLcyVx9tp0hUTVe-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F_c80MLcyVx9tp0hUTVe-2" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;DeepseekV2Model&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="321" y="470" width="186" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F_c80MLcyVx9tp0hUTVe-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="F_c80MLcyVx9tp0hUTVe-4" target="F_c80MLcyVx9tp0hUTVe-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F_c80MLcyVx9tp0hUTVe-4" value="lm_head" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="354" y="610" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F_c80MLcyVx9tp0hUTVe-6" value="nn.Liner" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="154" y="610" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="0Zy3fMC0m3OLqDAqN8_3" name="DeepseekV2Model">
    <mxGraphModel dx="2256" dy="847" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="8eXNXKhD9lE4CFKMECff-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="XyQ0NpWBHUa_T1B052xM-1" target="8eXNXKhD9lE4CFKMECff-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XyQ0NpWBHUa_T1B052xM-1" value="&lt;span style=&quot;color: rgb(204, 204, 204); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; white-space: pre; background-color: rgb(31, 31, 31);&quot;&gt;DeepseekV2Model&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="330" y="210" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="XyQ0NpWBHUa_T1B052xM-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="XyQ0NpWBHUa_T1B052xM-2" target="XyQ0NpWBHUa_T1B052xM-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8eXNXKhD9lE4CFKMECff-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="XyQ0NpWBHUa_T1B052xM-2" target="8eXNXKhD9lE4CFKMECff-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XyQ0NpWBHUa_T1B052xM-2" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;decoder_layer&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="345" y="440" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8eXNXKhD9lE4CFKMECff-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="XyQ0NpWBHUa_T1B052xM-4" target="8eXNXKhD9lE4CFKMECff-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="XyQ0NpWBHUa_T1B052xM-4" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;norm&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="345" y="580" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8eXNXKhD9lE4CFKMECff-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="8eXNXKhD9lE4CFKMECff-1" target="8eXNXKhD9lE4CFKMECff-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8eXNXKhD9lE4CFKMECff-1" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;DeepseekV2RMSNorm&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="110" y="580" width="155" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8eXNXKhD9lE4CFKMECff-3" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;DeepseekV2DecoderLayer&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="60" y="440" width="205" height="60" as="geometry" />
        </mxCell>
        <mxCell id="8eXNXKhD9lE4CFKMECff-5" value="&lt;img alt=&quot;&quot; src=&quot;data:image/png;base64,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&quot;&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-170" y="555" width="192.5" height="110" as="geometry" />
        </mxCell>
        <mxCell id="8eXNXKhD9lE4CFKMECff-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="8eXNXKhD9lE4CFKMECff-7" target="XyQ0NpWBHUa_T1B052xM-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="8eXNXKhD9lE4CFKMECff-7" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;nn.Embedding&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="345" y="330" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="Y3mxDfZyBRyGnsacDS5G" name="DeepseekV2DecoderLayer">
    <mxGraphModel dx="1429" dy="847" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="Q-8fmy8MpRO36G6xc3KD-4" target="Q-8fmy8MpRO36G6xc3KD-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" target="Q-8fmy8MpRO36G6xc3KD-21">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="395" y="330" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="210" y="330" />
              <mxPoint x="210" y="610" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-4" value="DeepseekV2DecoderLayer" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="310" y="240" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="Q-8fmy8MpRO36G6xc3KD-6" target="Q-8fmy8MpRO36G6xc3KD-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-6" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div style=&quot;line-height: 19px;&quot;&gt;&lt;div style=&quot;line-height: 19px;&quot;&gt;DeepseekV2RMSNorm&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="297.5" y="360" width="195" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Q-8fmy8MpRO36G6xc3KD-8" target="Q-8fmy8MpRO36G6xc3KD-21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-8" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div style=&quot;line-height: 19px;&quot;&gt;&lt;div style=&quot;line-height: 19px;&quot;&gt;ATTENTION_CLASSES&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="282.5" y="480" width="225" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="Q-8fmy8MpRO36G6xc3KD-11" target="Q-8fmy8MpRO36G6xc3KD-14">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" target="Q-8fmy8MpRO36G6xc3KD-15">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="395" y="650" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="210" y="650" />
              <mxPoint x="210" y="940" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-11" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div style=&quot;line-height: 19px;&quot;&gt;DeepseekV2RMSNorm&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="272.5" y="680" width="245" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Q-8fmy8MpRO36G6xc3KD-14" target="Q-8fmy8MpRO36G6xc3KD-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-14" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div style=&quot;line-height: 19px;&quot;&gt;&lt;div style=&quot;line-height: 19px;&quot;&gt;mlp&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="335" y="800" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-15" value="&lt;b&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;+&lt;/font&gt;&lt;/b&gt;" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;" vertex="1" parent="1">
          <mxGeometry x="375" y="920" width="40" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-16" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="530" y="450" width="20" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-17" value="&lt;div style=&quot;color: #cccccc;background-color: #1f1f1f;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div style=&quot;line-height: 19px;&quot;&gt;DeepseekV2Attention&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="560" y="450" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-18" value="&lt;div style=&quot;color: #cccccc;background-color: #1f1f1f;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div style=&quot;line-height: 19px;&quot;&gt;DeepseekV2FlashAttention2&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="560" y="530" width="190" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Q-8fmy8MpRO36G6xc3KD-21" target="Q-8fmy8MpRO36G6xc3KD-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-21" value="&lt;b&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;+&lt;/font&gt;&lt;/b&gt;" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;" vertex="1" parent="1">
          <mxGeometry x="375" y="590" width="40" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-23" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="487.5" y="770" width="20" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-24" value="&lt;div style=&quot;color: #cccccc;background-color: #1f1f1f;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;DeepseekV2MoE&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="517.5" y="770" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="Q-8fmy8MpRO36G6xc3KD-25" target="Q-8fmy8MpRO36G6xc3KD-26">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-25" value="&lt;div style=&quot;color: #cccccc;background-color: #1f1f1f;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #cccccc;&quot;&gt;DeepseekV2MLP&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="517.5" y="850" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Q-8fmy8MpRO36G6xc3KD-26" value="&lt;div style=&quot;color: rgb(204, 204, 204); background-color: rgb(31, 31, 31); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;DeepseekV2MLP&lt;/span&gt;(&lt;span style=&quot;color: #4ec9b0;&quot;&gt;nn&lt;/span&gt;.&lt;span style=&quot;color: #4ec9b0;&quot;&gt;Module&lt;/span&gt;):&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;__init__&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;self&lt;/span&gt;, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;config&lt;/span&gt;, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;hidden_size&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;None&lt;/span&gt;, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;intermediate_size&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;None&lt;/span&gt;):&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #4ec9b0;&quot;&gt;super&lt;/span&gt;().&lt;span style=&quot;color: #dcdcaa;&quot;&gt;__init__&lt;/span&gt;()&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.config &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; config&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.hidden_size &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; config.hidden_size &lt;span style=&quot;color: #c586c0;&quot;&gt;if&lt;/span&gt; hidden_size &lt;span style=&quot;color: #569cd6;&quot;&gt;is&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;None&lt;/span&gt; &lt;span style=&quot;color: #c586c0;&quot;&gt;else&lt;/span&gt; hidden_size&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.intermediate_size &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; (&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; config.intermediate_size &lt;span style=&quot;color: #c586c0;&quot;&gt;if&lt;/span&gt; intermediate_size &lt;span style=&quot;color: #569cd6;&quot;&gt;is&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;None&lt;/span&gt; &lt;span style=&quot;color: #c586c0;&quot;&gt;else&lt;/span&gt; intermediate_size&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; )&lt;/div&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.gate_proj &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; nn.Linear(&lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.hidden_size, &lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.intermediate_size, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;bias&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;False&lt;/span&gt;)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.up_proj &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; nn.Linear(&lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.hidden_size, &lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.intermediate_size, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;bias&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;False&lt;/span&gt;)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.down_proj &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; nn.Linear(&lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.intermediate_size, &lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.hidden_size, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;bias&lt;/span&gt;&lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #569cd6;&quot;&gt;False&lt;/span&gt;)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.act_fn &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; ACT2FN[config.hidden_act]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #569cd6;&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color: #dcdcaa;&quot;&gt;forward&lt;/span&gt;(&lt;span style=&quot;color: #9cdcfe;&quot;&gt;self&lt;/span&gt;, &lt;span style=&quot;color: #9cdcfe;&quot;&gt;x&lt;/span&gt;):&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; down_proj &lt;span style=&quot;color: #d4d4d4;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.down_proj(&lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.act_fn(&lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.gate_proj(x)) &lt;span style=&quot;color: #d4d4d4;&quot;&gt;*&lt;/span&gt; &lt;span style=&quot;color: #569cd6;&quot;&gt;self&lt;/span&gt;.up_proj(x))&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #c586c0;&quot;&gt;return&lt;/span&gt; down_proj&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;arcSize=0;" vertex="1" parent="1">
          <mxGeometry x="740" y="697.5" width="720" height="345" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="Nk0kHJ_5extDd6zerjkt" name="DeepseekV2Attention">
    <mxGraphModel dx="1429" dy="847" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
